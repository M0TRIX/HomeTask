version: v1.0
name: Swift
agent:
  machine:
    type: a1-standard-4
    os_image: macos-xcode12
blocks:
  - name: Tests
    task:
      jobs:
        - name: swift test
          commands:
            - checkout
            - 'xcodebuild clean build -workspace "HomeTask.xcworkspace" -scheme "HomeTask" -destination "platform=iOS Simulator,name=iPhone 12 Pro,OS=latest" CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO ONLY_ACTIVE_ARCH=NO'
  - name: 'Block #2'
    task:
      jobs:
        - name: 'Job #1'
          commands:
            - '- name: Run tests'
            - '  task:'
            - '    env_vars:'
            - '      - name: LANG'
            - '        value: en_US.UTF-8'
            - '    prologue:'
            - '      commands:'
            - '        - checkout'
            - '        - cache restore'
            - '        - bundle install --path vendor/bundle'
            - '        - cache store'
            - '    jobs:'
            - '      - name: Test'
            - '        commands:'
            - '          - bundle exec xcversion select 11.2.1'
            - '          - bundle exec fastlane test'
